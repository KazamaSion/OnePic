<!DOCTYPE html>
<html>
  <head>
    <title>registration</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <style>
      body { padding-top: 50px; padding-bottom: 50px; }
    </style>
    <script src="./js/jquery-2.1.3.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script src="../../node_modules/vue/dist/vue.js"></script>
    <script src="../../dist/vue-validator.js"></script>
  </head>
  <body>
    <div id="app"></div>
    <script>
      (function () {
        Vue.use(window['vue-validator'])

        var opts = {
          template: '<input type="text" v-model="foo" wait-for="fooLoaded" v-validate="required">'
            + '<input type="text" v-model="bar" wait-for="barLoaded" v-validate="required, maxLength: 5">'
            + '<button v-if="valid && dirty">submit</button>',
          data: {
            foo: '',
            bar: ''
          },
          watch: {
            foo: function (val, old) {
              var self = this
              Vue.nextTick(function () {
                console.log('watch foo', val, old, JSON.stringify(self.$data))
              })
            },
            bar: function (val, old) {
              var self = this
              Vue.nextTick(function () {
                console.log('watch bar', val, old, JSON.stringify(self.$data))
              })
            }
          },
          ready: function () {
            var self = this
            var get = function (params, fn) {
              setTimeout(function () {
                fn(null, {
                  foo: 'hello',
                  bar: 'kazupon'
                })
              }, 2000)
            }

            var params = {}
            get(params, function (err, data) {
              self.$emit('fooLoaded', 'foo', data.foo)
              self.$emit('barLoaded', 'bar', data.bar)
              console.log('loaded', JSON.stringify(self.$data))
            })

            console.log('ready', JSON.stringify(this.$data))
          }
        }

        new Vue(opts).$mount('#app')
      })()
    </script>
  </body>
</html>
